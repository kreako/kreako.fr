---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Contents } from '../../components/content.mjs'
import Ressource from '../../components/Ressource.jsx'

export async function getStaticPaths({rss}) {
  const contents = await Contents.fetch()
  await contents.addMarkdownDescription()

  // rss generation
  rss({
    title: 'Kreakoâ€™s Blog',
    description: 'Ressources, links and notes',
    customData: `<language>en-us</language>`,
    items: contents.datas.map(item => ({
      title: item.title,
      description: item.data.description_md.__html,
      link: item.url,
      pubDate: item.dt_created_at,
    })),
    dest: "/rss.xml",
  });

  return contents.datas.map(ressource => {
    return {
      params: {
        data: ressource.url_data,
      },
      props: { ressource: ressource },
    }
  })
}

const { data } = Astro.request.params;
const { ressource } = Astro.props;
---
<BaseLayout title={ressource.title}>
  <section class="px-2 mt-8 max-w-screen-md">
    <div class="">
      <Ressource content={ressource}/>
    </div>
  </section>
</BaseLayout>